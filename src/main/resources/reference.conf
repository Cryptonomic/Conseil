# Default global configuration file. Should be overriden for full functionality.

# Runtime settings for Conseil server
conseil: {
  hostname: "0.0.0.0"
  port: 1337
  cache-ttl: 15 minutes
  max-query-result-size: 100000
}

# Runtime settings for Lorre process
lorre: {
  sleepInterval: 60 s
  bootupRetryInterval: 10 s
  bootupConnectionCheckTimeout: 10 s
  #Used to make sure Lorre records average fees every n iterations
  feeUpdateInterval: 20
  #Used to select how many fees should be averaged together
  numberOfFeesAveraged: 1000
  depth: newest,
  headHash: None
}

# Used for configuring Typesafe Slick. Replace database name, user and password in an env-specific config file.
conseildb = {
  dataSourceClass = "org.postgresql.ds.PGSimpleDataSource"
  properties = {
    databaseName = "conseil"
    user = "foo"
    password = "bar"
    reWriteBatchedInserts = true
  }
  # The following numbers are based on literature from here: https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing
  # We might want to fine-tune these on the actual infrastructure, doing testing with different values
  # Please keep both values aligned in your configuration to avoid this issue: https://github.com/dnvriend/akka-persistence-jdbc/issues/177
  numThreads = 10
  maxConnections = 10
}

#Slick debug level
logger.scala.slick = INFO


#Used for configuring time-out for reading a web response content
#Timeout on sync network calls
requestAwaitTime: 120 s
#Timeouts to read the response into a strict string
GETResponseEntityTimeout: 90 s
POSTResponseEntityTimeout: 1 s

batchedFetches {
  # The following configs defines how many concurrent requests we'd like to run
  #   against a tezos node to speed up fetching of data
  # This values should take into account the overall load that will be generated by
  #   all fetching operations that could be generated by different Conseil
  #   instances (if more than one) and the number of requests sent by each
  #   said operations, and be compared to the load handling capabilities
  #   of the Tezos node itself

  #Used when getting accounts from tezos
  accountConcurrencyLevel = 5

  #Used when getting operation data for each new block just fetched
  blockOperationsConcurrencyLevel = 10

  #Used to paginate blocks read from tezos before each db storage
  blockPageSize = 500

  #Used to specify the max-time allowed for each block-page to finish processing
  #Currently takes into account the time to process all corresponding accounts for each page
  blockPageProcessingTimeout = 15 minutes

  #Used to specify the max-time allowed for each accounts-page to finish processing
  accountPageProcessingTimeout = 5 minutes
}

# Settings for blockchains Conseil can connect to. Nested by blockchain name and network.
platforms: {
  tezos: {
    zeronet: {
      node: {
        protocol: "https"
        hostname: "nautilus.cryptonomic.tech",
        port: 8732
        pathPrefix: "tezos/zeronet/"
      }
    }
  }
}

# Security settings
security: {
  apiKeys: {
    # List of authorized API keys needed to query Conseil
    keys: []
  }
}

# Custom libSodium settings
sodium: {
  libraryPath: "/usr/lib/x86_64-linux-gnu/libsodium.so.18"
}

# Customization on the underlying actor system
akka {

  # custom host pool for akka-http client connections used for streaming request/responses
  # tune the configuration based on load-handling capability of tezos nodes
  # refer to host-connection-pool section in
  # https://doc.akka.io/docs/akka-http/current/configuration.html
  # for available properties and their meaning
  #
  # The current configuration is based on local benchmarking against zeronet
  # To improve or check it, look at the tech.cryptonomic.conseil.NodeStreamingBenchmark app
  # On the streaming http client pool we expect a max of:
  #   30 connections x
  #    7 requests/conn ~=
  #  210 ongoing requests at each moment
  # The pipelining on each connection might slow down for slow responses, but they should be rare
  tezos-streaming-client {
    max-connections = 30
    # The 2048 limit is thus overestimated by a factor of roughly 10x, to allow room for
    # reuse of the same pool from different threads at the same time, up to that factor
    max-open-requests = 2048
    # essentially keep connections alive across lorre's cycles
    idle-timeout = 10 minutes
    pipelining-limit = 7
    # give more room for async response in head-of-line blocking on the same connection or other slow responses
    response-entity-subscription-timeout = 5 seconds
  }

  # this is essentially available to enable composition of database operations
  # current configuration is based upon the default-blocking-io-dispatcher in akka
  tezos-dispatcher {
    type = "Dispatcher"
    executor = "thread-pool-executor"
    throughput = 1

    thread-pool-executor {
      fixed-pool-size = 16
    }
  }

  http {
    server {
      request-timeout = 5 minutes
      idle-timeout = 5 minutes
    }
  }
}

# This is the configuration for metadata overrides. You can override visibility and display name for platform, network,
# entities and attributes. On each level you can set these parameters:
# * display-name: String
# * visible: Boolean (false by default)
# * description: String
#
# Additionally, on attributes level you can provide following parameters:
# * placeholder: String
# * data-format: String
# * value-map: Map[String, String], example: {"0": "Yay", "1": "Nay", "2": "Pass"},
# * reference: Map[String, String], example: {"entity": "accounts", "key": "account_id"}, so UI can create links between fields
# * data-type: String, since this value is later mapped to enum, values are limited to those supported by method
#                      tech.cryptonomic.conseil.tezos.TezosPlatformDiscoveryOperations.mapType
# * scale: Int, indicate to the UI how to display a value
#
# And on entity level:
# * display-name-plural: String

metadata-configuration {
  tezos {
    visible: true
    networks {
      mainnet {
        visible: true
        entities {
          accounts {
            visible: true
            display-name: "Account"
            display-name-plural: "Accounts"
            attributes {
              account_id {
                description: "Sometimes referred to as 'public key hash', the address is a unique account identifier"
                display-name: "Address"
                placeholder: "tz1..."
                visible: true
                data-type: "accountAddress"
                cache-config {
                  cached: true
                  min-match-length: 4
                  max-result-size: 20
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              manager {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              spendable {
                visible: true
              }
              delegate_setable {
                display-name: "Delegatable"
                visible: true
              }
              delegate_value {
                display-name: "Delegate"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              counter {
                visible: true
              }
              script {
                visible: true
              }
              storage {
                visible: true
              }
              balance {
                visible: true
                scale: 6
              }
              block_level {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          rolls {
            visible: true
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
                cache-config {
                  cached: true
                  min-match-length: 4
                  max-result-size: 20
                }
              }
              rolls {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level {
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          balance_updates {
            display-name: "Balance Update"
            display-name-plural: "Balance Updates"
            visible: true
            attributes {
              id {
                visible: true
              }
              source {
                visible: true
              }
              source_id {
                visible: true
              }
              source_hash {
                visible: true
                data-type: "hash"
                display-name: "Source Hash"
              }
              kind {
                visible: true
              }
              contract {
                visible: true
                data-type: "accountAddress"
              }
              change {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              level {
                visible: true
              }
              delegate {
                visible: true
                data-type: "accountAddress"
              }
              category {
                visible: true
              }
            }
          }
          ballots {
            visible: true
            display-name: "Ballot"
            display-name-plural: "Ballots"
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              ballot {
                display-name: "Vote"
                visible: true
                value-map: {
                  "0": "Yay",
                  "1": "Nay",
                  "2": "Pass"
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level {
                display-name: "Block Level"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          blocks {
            visible: true
            display-name: "Block"
            display-name-plural: "Blocks"
            attributes {
              level {
                visible: true
              }
              proto {
                visible: true
              }
              predecessor {
                display-name: "Predecessor Hash"
                visible: true
                data-type: "hash"
                reference {
                  entity: "blocks"
                  key: "hash"
                }
              }
              timestamp {
                data-format: "YYYY MMM DD, HH:mm Z"
                visible: true
              }
              validation_pass {
                visible: true
              }
              fitness {
                visible: true
              }
              context {
                visible: true
              }
              signature {
                visible: true
              }
              protocol {
                visible: true
              }
              chain_id {
                visible: true
              }
              hash {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
              }
              operations_hash {
                display-name: "Operations Hash"
                visible: true
                data-type: "hash"
                reference: {
                  entity: "operations"
                  key: "operation_group_hash"
                }
              }
              period_kind {
                visible: true
              }
              current_expected_quorum {
                visible: true
              }
              active_proposal {
                visible: true
              }
              baker {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              nonce_hash {
                visible: true
              }
              consumed_gas {
                visible: true
              }
              meta_level {
                visible: true
              }
              meta_level_position {
                visible: true
              }
              meta_cycle {
                visible: true
              }
              meta_cycle_position {
                visible: true
              }
              meta_voting_period {
                visible: true
              }
              meta_voting_period_position {
                visible: true
              }
              expected_commitment {
                visible: true
              }
            }
          }
          fees {
            visible: true
            display-name: "Fee"
            display-name-plural: "Fees"
            attributes {
              low {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              medium {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              high {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              timestamp {
                visible: true
                data-format: "YYYY MMM DD, HH:mm Z"
              }
              kind {
                visible: true
              }
            }
          }
          operation_groups {
            display-name: "Operation Group"
            display-name-plural: "Operation Groups"
            visible: true
            attributes {
              protocol {
                visible: true
                data-type: "hash"
              }
              chain_id {
                visible: true
              }
              hash {
                visible: true
                data-type: "hash"
              }
              branch {
                visible: true
                data-type: "hash"
              }
              signature {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
            }
          }
          operations {
            visible: true
            display-name: "Operation"
            display-name-plural: "Operations"
            attributes {
              operation_id: {
                visible: false
              }
              operation_group_hash: {
                visible: true
                display-name: "Op Group Hash"
                data-type: "hash"
              }
              kind: {
                visible: true
              }
              level: {
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
              delegate: {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              slots: {
                visible: true
              }
              nonce: {
                visible: true
              }
              pkh: {
                visible: true
              }
              secret: {
                visible: true
              }
              source: {
                visible: true
                data-type: "accountAddress"
                reference {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              fee: {
                visible: true
                scale: 6
              }
              counter: {
                visible: true
              }
              gas_limit: {
                visible: true
                display-name: "Gas Limit"
                scale: 6
              }
              storage_limit: {
                visible: true
                display-name: "Storage Limit"
                scale: 6
              }
              public_key: {
                visible: true
              }
              amount: {
                visible: true
                scale: 6
              }
              destination: {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              parameters: {
                visible: true
              }
              manager_pubkey: {
                visible: true
              }
              balance: {
                visible: true
                scale: 6
              }
              spendable: {
                visible: true
              }
              delegatable: {
                visible: true
              }
              script: {
                visible: true
              }
              storage: {
                visible: true
              }
              status: {
                visible: true
              }
              consumed_gas: {
                visible: true
                display-name: "Consumed Gas"
                scale: 6
              }
              block_hash: {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level: {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
              timestamp: {
                visible: true
                data-format: "YYYY MMM DD, HH:mm Z"
              }
            }
          }
          proposals {
            visible: true
            display-name: "Proposal"
            display-name-plural: "Proposals"
            attributes {
              protocol_hash {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                visible: true
              }
              block_level {
                visible: true
              }
            }
          }
          delegates {
            visible: true
            display-name: "Delegate"
            display-name-plural: "Delegates"
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              balance {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              frozen_balance {
                display-name: "Frozen Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              staking_balance {
                display-name: "Staking Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              delegated_balance {
                display-name: "Delegated Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              deactivated {
                visible: true
              }
              grace_period {
                visible: true  
              }
              block_level {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
        }
      }
      alphanet {
        visible: true
        entities {
          accounts {
            visible: true
            display-name: "Account"
            display-name-plural: "Accounts"
            attributes {
              account_id {
                description: "Sometimes referred to as 'public key hash', the address is a unique account identifier"
                display-name: "Address"
                placeholder: "tz1..."
                visible: true
                data-type: "accountAddress"
                cache-config {
                  cached: true
                  min-match-length: 4
                  max-result-size: 20
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              manager {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              spendable {
                visible: true
              }
              delegate_setable {
                display-name: "Delegatable"
                visible: true
              }
              delegate_value {
                display-name: "Delegate"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              counter {
                visible: true
              }
              script {
                visible: true
              }
              storage {
                visible: true
              }
              balance {
                visible: true
                scale: 6
              }
              block_level {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          rolls {
            visible: true
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
                cache-config {
                  cached: true
                  min-match-length: 4
                  max-result-size: 20
                }
              }
              rolls {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level {
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          balance_updates {
            display-name: "Balance Update"
            display-name-plural: "Balance Updates"
            visible: true
            attributes {
              id {
                visible: true
              }
              source {
                visible: true
              }
              source_id {
                visible: true
              }
              source_hash {
                visible: true
                data-type: "hash"
                display-name: "Source Hash"
              }
              kind {
                visible: true
              }
              contract {
                visible: true
                data-type: "accountAddress"
              }
              change {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              level {
                visible: true
              }
              delegate {
                visible: true
                data-type: "accountAddress"
              }
              category {
                visible: true
              }
            }
          }
          ballots {
            visible: true
            display-name: "Ballot"
            display-name-plural: "Ballots"
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              ballot {
                display-name: "Vote"
                visible: true
                value-map: {
                  "0": "Yay",
                  "1": "Nay",
                  "2": "Pass"
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level {
                display-name: "Block Level"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
          blocks {
            visible: true
            display-name: "Block"
            display-name-plural: "Blocks"
            attributes {
              level {
                visible: true
              }
              proto {
                visible: true
              }
              predecessor {
                display-name: "Predecessor Hash"
                visible: true
                data-type: "hash"
                reference {
                  entity: "blocks"
                  key: "hash"
                }
              }
              timestamp {
                data-format: "YYYY MMM DD, HH:mm Z"
                visible: true
              }
              validation_pass {
                visible: true
              }
              fitness {
                visible: true
              }
              context {
                visible: true
              }
              signature {
                visible: true
              }
              protocol {
                visible: true
              }
              chain_id {
                visible: true
              }
              hash {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
              }
              operations_hash {
                display-name: "Operations Hash"
                visible: true
                data-type: "hash"
                reference: {
                  entity: "operations"
                  key: "operation_group_hash"
                }
              }
              period_kind {
                visible: true
              }
              current_expected_quorum {
                visible: true
              }
              active_proposal {
                visible: true
              }
              baker {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              nonce_hash {
                visible: true
              }
              consumed_gas {
                visible: true
              }
              meta_level {
                visible: true
              }
              meta_level_position {
                visible: true
              }
              meta_cycle {
                visible: true
              }
              meta_cycle_position {
                visible: true
              }
              meta_voting_period {
                visible: true
              }
              meta_voting_period_position {
                visible: true
              }
              expected_commitment {
                visible: true
              }
            }
          }
          fees {
            visible: true
            display-name: "Fee"
            display-name-plural: "Fees"
            attributes {
              low {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              medium {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              high {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              timestamp {
                visible: true
                data-format: "YYYY MMM DD, HH:mm Z"
              }
              kind {
                visible: true
              }
            }
          }
          operation_groups {
            display-name: "Operation Group"
            display-name-plural: "Operation Groups"
            visible: true
            attributes {
              protocol {
                visible: true
                data-type: "hash"
              }
              chain_id {
                visible: true
              }
              hash {
                visible: true
                data-type: "hash"
              }
              branch {
                visible: true
                data-type: "hash"
              }
              signature {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
            }
          }
          operations {
            visible: true
            display-name: "Operation"
            display-name-plural: "Operations"
            attributes {
              operation_id: {
                visible: false
              }
              operation_group_hash: {
                visible: true
                display-name: "Op Group Hash"
                data-type: "hash"
              }
              kind: {
                visible: true
              }
              level: {
                visible: true
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
              delegate: {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              slots: {
                visible: true
              }
              nonce: {
                visible: true
              }
              pkh: {
                visible: true
              }
              secret: {
                visible: true
              }
              source: {
                visible: true
                data-type: "accountAddress"
                reference {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              fee: {
                visible: true
                scale: 6
              }
              counter: {
                visible: true
              }
              gas_limit: {
                visible: true
                display-name: "Gas Limit"
                scale: 6
              }
              storage_limit: {
                visible: true
                display-name: "Storage Limit"
                scale: 6
              }
              public_key: {
                visible: true
              }
              amount: {
                visible: true
                scale: 6
              }
              destination: {
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              parameters: {
                visible: true
              }
              manager_pubkey: {
                visible: true
              }
              balance: {
                visible: true
                scale: 6
              }
              spendable: {
                visible: true
              }
              delegatable: {
                visible: true
              }
              script: {
                visible: true
              }
              storage: {
                visible: true
              }
              status: {
                visible: true
              }
              consumed_gas: {
                visible: true
                display-name: "Consumed Gas"
                scale: 6
              }
              block_hash: {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              block_level: {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
              timestamp: {
                visible: true
                data-format: "YYYY MMM DD, HH:mm Z"
              }
            }
          }
          proposals {
            visible: true
            display-name: "Proposal"
            display-name-plural: "Proposals"
            attributes {
              protocol_hash {
                visible: true
              }
              block_id {
                display-name: "Block Hash"
                visible: true
              }
              block_level {
                visible: true
              }
            }
          }
          delegates {
            visible: true
            display-name: "Delegate"
            display-name-plural: "Delegates"
            attributes {
              pkh {
                display-name: "Address"
                visible: true
                data-type: "accountAddress"
                reference: {
                  entity: "accounts"
                  key: "account_id"
                }
              }
              block_id {
                display-name: "Block Hash"
                data-type: "hash"
                visible: true
                reference: {
                  entity: "blocks"
                  key: "hash"
                }
              }
              balance {
                visible: true
                data-type: "decimal"
                scale: 6
              }
              frozen_balance {
                display-name: "Frozen Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              staking_balance {
                display-name: "Staking Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              delegated_balance {
                display-name: "Delegated Balance"
                visible: true
                data-type: "decimal"
                scale: 6
              }
              deactivated {
                visible: true
              }
              grace_period {
                visible: true  
              }
              block_level {
                visible: true
                display-name: "Block Level"
                reference: {
                  entity: "blocks"
                  key: "level"
                }
              }
            }
          }
        }
      }
    }
  }
}
